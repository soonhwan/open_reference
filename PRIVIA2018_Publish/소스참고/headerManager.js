var navData = {
	"air": {
		"link": "http://www.priviatravel.com/main/air/",
		"title": "항공",
		"subNavDisplayToGNB": true,
		"subNav": [{
			"link": "http://air.priviatravel.com/booking/findListSpcExhibition.lts?efcCodeList=RB0224&template_divn=A&efcCityCode=LAX",
			"title": "아시아나항공 미주 SUMMER 특가",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "https://www.priviatravel.com/promotion/sectionEvent/2281/",
			"title": "대한항공 특별혜택",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/promotion/sectionEvent/2309/",
			"title": "프리미엄 클래스 특가",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/promotion/sectionEvent/1879/",
			"title": "특별 할인 지역전용관",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}],
		"newWindow": false
	},
	"hotel": {
		"link": "http://www.priviatravel.com/main/hotel/",
		"title": "호텔",
		"subNavDisplayToGNB": true,
		"subNav": [{
			"link": "http://hotel.priviatravel.com/htl/bk/HtlSearchPromo.lts?phc_pmh_id=P0214HTL0821&template_divn=A",
			"title": "해외호텔핫딜",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "https://www.priviatravel.com/promotion/sectionEvent/2398/",
			"title": "여름 쿠폰 1만원/ 5만원 /10만원",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://hotel.priviatravel.com/htl/bk/HtlSearchPromo.lts?phc_pmh_id=P0518HTL0019144&template_divn=A",
			"title": "일본 소도시 5% 할인 쿠폰",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}],
		"newWindow": false
	},
	"airtel": {
		"link": "http://www.priviatravel.com/main/free/",
		"title": "자유여행",
		"subNavDisplayToGNB": true,
		"subNav": [{
			"link": "http://www.priviatravel.com/promotion/sectionEvent/2350/",
			"title": "조기 예약 10만원 쿠폰",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "https://www.priviatravel.com/promotion/sectionEvent/2401/",
			"title": "홍콩 자유여행 특별 혜택",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "https://www.priviatravel.com/promotion/sectionEvent/2076/",
			"title": "올 인크루시브 괌",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://airtel.priviatravel.com/dprs/fr/realtime/rcdCityList.lts?par_cat_id=8875",
			"title": "프리미엄 에어텔",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}],
		"newWindow": false
	},
	"dprs": {
		"link": "http://airtel.priviatravel.com/dprs/fr/freetour/freeTour.lts",
		"title": "투어&액티비티",
		"subNavDisplayToGNB": true,
		"subNav": [{
			"link": "https://www.priviatravel.com/promotion/sectionEvent/2343/",
			"title": "렌터카(해외, 국내) 할인",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "https://www.priviatravel.com/promotion/sectionEvent/2297/",
			"title": "유럽 유레일 할인",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "https://www.priviatravel.com/promotion/sectionEvent/2340/",
			"title": "다낭 현지투어 할인",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "https://www.priviatravel.com/promotion/sectionEvent/1759/",
			"title": "해외 여행자 보험",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://travel.maaltalk.com/id/privia",
			"title": "포켓WI-FI / 해외유심",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}],
		"newWindow": false
	},
	"pkg": {
		"link": "http://package.priviatravel.com/pkgRenewal/",
		"title": "해외패키지",
		"subNavDisplayToGNB": false,
		"subNav": [{
			"link": "http://package.priviatravel.com/pkgRenewal/sectionRecommend?regncd=A",
			"title": "동남아",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://package.priviatravel.com/pkgRenewal/sectionRecommend?regncd=C",
			"title": "홍콩/중국",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://package.priviatravel.com/pkgRenewal/sectionRecommend?regncd=J",
			"title": "일본",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://package.priviatravel.com/pkgRenewal/sectionRecommend?regncd=P",
			"title": "남태평양",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://package.priviatravel.com/pkgRenewal/sectionRecommend?regncd=E",
			"title": "유럽",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://package.priviatravel.com/pkgRenewal/sectionRecommend?regncd=H",
			"title": "미주/하와이",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://package.priviatravel.com/pkgRenewal/themaTreavelJaGoods",
			"title": "테마여행",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}],
		"newWindow": false
	},
	"domestic": {
		"link": "http://domestic.priviatravel.com/domestic/",
		"title": "국내여행",
		"subNavDisplayToGNB": true,
		"subNav": [{
			"link": "http://www.priviatravel.com/promotion/sectionEvent/2301/",
			"title": "제주호텔 2박 시 렌터카 무료",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://domestic.priviatravel.com/domestic/promotion/htmlPlan?PROMOTION_SEQ=39",
			"title": "남해 사우스 케이프 에어텔",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://domestic.priviatravel.com/domestic/searchList?goodsCd=GOODS001&agencyCd=&travelType=AIRCARTEL",
			"title": "제주도 에어텔",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "https://www.priviatravel.com/promotion/sectionEvent/2441/",
			"title": "국내숙박 1/2/3만원 할인 쿠폰",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}],
		"newWindow": false
	},
	"promotion": {
		"link": "http://www.priviatravel.com/promotion/promotionList",
		"title": "기획전",
		"subNavDisplayToGNB": false,
		"subNav": [{
			"link": "http://www.priviatravel.com/promotion/promotionList?recomDivn=AIR",
			"title": "항공",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/promotion/promotionList?recomDivn=HOTEL",
			"title": "호텔",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/promotion/promotionList?recomDivn=FREE",
			"title": "자유여행",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/promotion/promotionList?recomDivn=TAPROMO",
			"title": "투어&액티비티",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/promotion/promotionList?recomDivn=PACKAGE",
			"title": "해외패키지",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/promotion/promotionList?recomDivn=DOMESTIC ",
			"title": "국내여행",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}],
		"newWindow": false
	},
	"payment": {
		"link": "http://www.priviatravel.com/etc/aboutPRIVIA",
		"title": "혜택 및 서비스",
		"subNavDisplayToGNB": false,
		"subNav": [{
			"link": "http://www.priviatravel.com/etc/aboutAIR",
			"title": "항공",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/etc/aboutHOTEL",
			"title": "호텔",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/etc/aboutAIRTEL",
			"title": "자유여행",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/etc/aboutDPRS",
			"title": "투어&액티비티",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/etc/aboutPKG",
			"title": "해외패키지",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/etc/aboutDOMESTIC",
			"title": "국내여행",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/etc/aboutPurpleVoucher",
			"title": "the Purple 혜택",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}],
		"newWindow": false
	},
	"customer": {
		"link": "http://www.priviatravel.com/customer/main/counselMain",
		"title": "고객센터",
		"subNavDisplayToGNB": false,
		"subNav": [{
			"link": "http://www.priviatravel.com/noticefaq/noticeList",
			"title": "공지사항",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/noticefaq/faqList",
			"title": "FAQ",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/customer/inquire/form",
			"title": "1:1문의",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/customer/counsel/main",
			"title": "해외맞춤여행",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/customer/crop/main",
			"title": "법인/단체여행",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}],
		"newWindow": false
	},
	"mypage": {
		"link": "https://www.priviatravel.com/mypage/index/reserve",
		"title": "마이페이지",
		"subNavDisplayToGNB": false,
		"subNav": [{
			"link": "http://www.priviatravel.com/mypage/index/reserve",
			"title": "예약내역",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/mypage/index/inquiry?menu=Inquiry",
			"title": "1:1문의 내역",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/mypage/index/counsel?menu=Counsel",
			"title": "해외 맞춤여행 문의 내역",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/mypage/index/benefit?menu=Coupon",
			"title": "PRIVIA 쿠폰",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/mypage/index/benefit?menu=Gift",
			"title": "PRIVIA 이용권",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/mypage/index/benefit?menu=Voucher",
			"title": "the Purple Voucher",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/mypage/index/benefit?menu=Reward",
			"title": "the Purple 리워드 쿠폰",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/mypage/index/benefit?menu=Discount",
			"title": "현대카드 할인 혜택",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/mypage/index/traveler?menu=Traveler",
			"title": "나의 여행자 관리",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}, {
			"link": "http://www.priviatravel.com/mypage/index/member?menu=Member",
			"title": "회원정보변경",
			"subNavDisplayToGNB": false,
			"subNav": null,
			"newWindow": false
		}],
		"newWindow": false
	},
	"about": {
		"link": "http://www.priviatravel.com/etc/aboutPriviaTab",
		"title": "About PRIVIA 여행",
		"subNavDisplayToGNB": false,
		"subNav": [],
		"newWindow": false
	},
	"picks": {
		"link": "http://www.priviatravel.com/special/main?seq=8",
		"title": "현대카드 PICKS",
		"subNavDisplayToGNB": false,
		"subNav": [],
		"newWindow": false
	}
};


/**********************************************************************
  GNB와 Quick서치 관련
   
   1. 퀵서치와 메뉴의 활성화 상태를 지정한다.
   2. 각 페이지 별로 아래의 상수를 이용하여 설정
   3. 샘플 
        <script type="text/javascript">
            setActiveCode(QUICK_CODE_HOTEL, GNB_CODE_AIR);
        </script>
**********************************************************************/
var QUICK_CODE_AIR = "AIR";
var QUICK_CODE_HOTEL = "HOTEL";
var QUICK_CODE_FREE = "FREE";
var QUICK_CODE_DPRS = "DPRS";
var QUICK_CODE_DPRS_ITEM = "DPRS_ITEM";
var QUICK_CODE_PACKAGE = "PACKAGE";

var GNB_CODE_AIR = "AIR";
var GNB_CODE_HOTEL = "HOTEL";
var GNB_CODE_FREE = "FREE";
var GNB_CODE_DPRS = "DPRS";
var GNB_CODE_PACKAGE = "PACKAGE";
var GNB_CODE_DOMESTIC = "DOMESTIC";
var GNB_CODE_PROMOTION = "PROMOTION";









document.domain = "priviatravel.com";

var QUICK_CODE = null;
var GNB_CODE = null;


// 활성화
function setActiveCode(quickCode, gnbCode) {

	if (quickCode) QUICK_CODE = quickCode;
	if (gnbCode) GNB_CODE = gnbCode;

	_focusGnb();
}

$(function () {

	_initQuick();
	_initGnb();
});


function _initQuick() {

	if (QUICK_CODE == null || QUICK_CODE == "") {
		QUICK_CODE = QUICK_CODE_AIR;
	}

	//퀵검색 메뉴 아이콘 클릭
	$('.quick-section-icon li a').click(function () {
		var idx = $(this).parent().index();
		$('.quick-section-icon li a').removeClass('on');
		$(this).addClass('on');
		$('.quick-section-cont').hide();
		$('.quick-section-cont').eq(idx).show();

		//최근검색 유무 조사
		if ($('#quickSearch-holder.sub-quick').size() > 0) {
			//자유여행이나 패키지 일 경우 보여주지 않음
			if (idx == 2 || idx == 5) { //#14594임시로 적용되었단 단품 제외처리 원복함
				$('#quickSearch-holder .quick-section').removeClass('recently');
			} else {
				$('#quickSearch-holder .quick-section').addClass('recently');

			}
		} else {
			$('#quickSearch-holder .quick-section').removeClass('recently');
		}

		var sectionName = $('.quick-section-cont').eq(idx).attr('id').split('-')[1];
		_requestQuick(sectionName);

		return false;
	});


	$('.btn-quickSearch').on('click', function (e) {
		if ($(this).hasClass('on')) {
			_showQuickTab(QUICK_CODE);
		}
	});
}

//퀵 ajax호출
var _pendingXDR = [];

function _addXDR(xdr) {
	_pendingXDR.push(xdr);
}

function _removeXDR(xdr) {
	for (var i = 0; i < _pendingXDR.length; i++) {

		if (_pendingXDR[i] === xdr) {
			_pendingXDR.splice(i, 1);
		}
	}
}

function _requestQuick(quickCode) {

	var sectionDom = $('#QS-' + quickCode);

	QUICK_CODE = quickCode;

	if ($.trim(sectionDom.html()).length == 0) {

		function setHtml(data) {
			try {

				if ($.trim(data).length > 0) {
					sectionDom.html(data);

					_applyQuickCallback();
				}
			} catch (e) {

				sectionDom.html("");

				if (window.console) console.log("[headerManager._requestQuick.setHtml : Exception] : 퀵서치 " + quickCode + " message : " + e.toString());
			}
		}

		var quickUrl = getQuickAjaxUrl(quickCode);

		if (quickUrl != null) {

			if ($.browser.msie && parseInt($.browser.version) <= 9 && window.XDomainRequest) {

				var xdr = new XDomainRequest();
				xdr.open("get", quickUrl);
				xdr.withCredentials = true;
				xdr.onload = function () {
					setHtml(xdr.responseText);
					_removeXDR(xdr);
				};
				xdr.onerror = xdr.ontimeout = function () {
					_removeXDR(xdr);
				};
				setTimeout(function () {
					xdr.send();
					_addXDR(xdr);
				}, 0);

			} else {

				$.support.cors = true;
				$.ajax({
					type: 'post',
					url: quickUrl,
					data: {},
					dataType: "html",
					cache: false,
					async: false,
					success: function (data) {
						setHtml(data);
					},
					error: function (request, status, error) {
						if (window.console) console.log("[headerManager : Error] : 퀵서치 " + quickCode + "\ncode:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
					},
					beforeSend: function (xhr) {
						xhr.withCredentials = true;
					}
				});
			}
		}
	} else {

		_applyQuickCallback();
	}

};

//재검색
function showQuick(quickCode, fn) {

	_setQuickCallback(fn);

	if (!$('#quickSearch-holder').is(':visible')) {
		if ($('.btn-total-nav').hasClass('on')) {
			$('.btn-total-nav').removeClass('on');
			$('.total-nav-layer').hide();
		}
		if ($('.l-total-nav-open').hasClass('on')) {
			$('.l-total-nav-open').removeClass('on');
			$('.l-total-nav-layer').hide();
		}
		if ($('.l-total-nav-open').hasClass('on')) {
			$('.l-total-nav-open').removeClass('on');
			$('.l-total-nav-layer').hide();
		}
		if ($('.l-gnb-sub').is(':visible')) {
			$('.l-gnb-sub').hide();
		}
		if ($('.btn-quickSearch').hasClass('on')) {
			$('.btn-quickSearch').removeClass('on');
			$('#quickSearch-holder').hide();
		} else {
			$('.btn-quickSearch').addClass('on');
			$('#quickSearch-holder').show();
		}
	}

	_showQuickTab(quickCode);
}

//퀵검색 탭메뉴 선택
function _showQuickTab(quickCode) {

	var _quickCode = quickCode ? quickCode : QUICK_CODE;

	switch (_quickCode) {

		case QUICK_CODE_AIR:
			$(".q-ico-air").trigger("click");
			break;
		case QUICK_CODE_HOTEL:
			$(".q-ico-htl").trigger("click");
			break;
		case QUICK_CODE_FREE:
			$(".q-ico-free").trigger("click");
			break;
		case QUICK_CODE_DPRS:
			$(".q-ico-c2").trigger("click");
			break;
		case QUICK_CODE_DPRS_ITEM:
			$(".q-ico-dprs").trigger("click");
			break;
		case QUICK_CODE_PACKAGE:
			$(".q-ico-pkg").trigger("click");
			break;
	}
}

var _showCallback = null;

function _setQuickCallback(fn) {

	try {

		if (typeof (fn) === 'function') {
			_showCallback = fn;
		} else {
			_showCallback = null;
		}

	} catch (e) {
		if (window.console) console.log("파라미터가 function형태가 아닙니다.");
	}
}

//퀵검색 로드 콜백
function _applyQuickCallback() {

	if (_showCallback) _showCallback();

	_showCallback = null;
}



//퀵주소
function getQuickAjaxUrl(quickCode) {

	var result = null;

	switch (quickCode) {

		case QUICK_CODE_AIR:
			result = "//air.priviatravel.com/airQuickSearch.lts";
			break;
		case QUICK_CODE_HOTEL:
			result = "//hotel.priviatravel.com/htlQuickSearch.lts";
			break;
		case QUICK_CODE_FREE:
			result = "//airtel.priviatravel.com/airtelQuickSearch.lts";
			break;
		case QUICK_CODE_DPRS:
			result = "//airtel.priviatravel.com/dprsQuickSearch.lts";
			break;
		case QUICK_CODE_DPRS_ITEM:
			result = "//airtel.priviatravel.com/dprsItemQuickSearch.lts";
			break;
		case QUICK_CODE_PACKAGE:
			result = "//www.priviatravel.com/search/pkg/form.ajax";
			break;
	}

	return result;
}


//해외출발 주소
function getDptFromAirQuickUrl() {

	return "//www.priviatravel.com/search/dptFromAir/form.ajax";
}

//해외출발 재검색 주소
function getRscDptFromAirQuickUrl() {

	return "//www.priviatravel.com/search/dptFromAir/researchform.ajax";
}


//GNB초기화
function _initGnb() {

	if (navData) {

		$("#gnb-nav > li").each(function () {

			var gnbKey = $(this).attr("id");

			gnbKey = gnbKey.replace(/gnb-item-/g, "");

			var aTag = $(this).find("a:first");
			aTag.attr("href", navData[gnbKey].link);
		});
	}
}


//GNB활성화
function _focusGnb() {

	switch (GNB_CODE) {

		case GNB_CODE_AIR:
			$("#gnb-item-air").addClass("on");
			break;
		case GNB_CODE_HOTEL:
			$("#gnb-item-hotel").addClass("on");
			break;
		case GNB_CODE_FREE:
			$("#gnb-item-airtel").addClass("on");
			break;
		case GNB_CODE_DPRS:
			$("#gnb-item-dprs").addClass("on");
			break;
		case GNB_CODE_PACKAGE:
			$("#gnb-item-pkg").addClass("on");
			break;
		case GNB_CODE_DOMESTIC:
			$("#gnb-item-domestic").addClass("on");
			break;
		case GNB_CODE_PROMOTION:
			$("#gnb-item-promotion").addClass("on");
			break;
	}
}
